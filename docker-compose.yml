name: develex-tasks

services:
  app:
    build:
      context: .
      dockerfile_inline: |
        FROM nginx:alpine
        COPY build/ /usr/share/nginx/html
        RUN echo 'server { listen 80; root /usr/share/nginx/html; index index.html; location / { try_files $$uri $$uri/ /index.html; } }' > /etc/nginx/conf.d/default.conf
        EXPOSE 80
        CMD ["nginx", "-g", "daemon off;"]
    container_name: develex-tasks
    restart: unless-stopped
    networks:
      - coolify
    labels:
      - "traefik.enable=true"
      # HTTPS router
      - "traefik.http.routers.develex-tasks.rule=Host(`${DOMAIN:-develex.phil.muni.cz}`)"
      - "traefik.http.routers.develex-tasks.entrypoints=https"
      - "traefik.http.routers.develex-tasks.tls.certresolver=letsencrypt"
      - "traefik.http.services.develex-tasks.loadbalancer.server.port=80"

      # HTTP â†’ HTTPS redirect
      - "traefik.http.routers.develex-tasks-http.rule=Host(`${DOMAIN:-develex.phil.muni.cz}`)"
      - "traefik.http.routers.develex-tasks-http.entrypoints=http"
      - "traefik.http.middlewares.develex-tasks-redirect.redirectscheme.scheme=https"
      - "traefik.http.middlewares.develex-tasks-redirect.redirectscheme.permanent=true"
      - "traefik.http.routers.develex-tasks-http.middlewares=develex-tasks-redirect"

networks:
  coolify:
    external: true